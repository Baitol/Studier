server {
    # Nginx слухає порт 80 (HTTP)
    listen 80;  
    
    # Домен або хост — у докері зазвичай не грає ролі, але мусить бути визначено
    server_name localhost;
    
    # Коренева директорія Laravel — обов’язково /public, інакше Nginx покаже весь код
    root /var/www/html/public;
    
    # Які файли вважати "головними" при заході на URL без файлу
    index index.php index.html;
    
    # Кодування за замовчуванням для відповідей (щоб коректно віддавати UTF-8)
    charset utf-8;
    
    # Захист від iframe clickjacking
    add_header X-Frame-Options "SAMEORIGIN";
    
    # Захист від MIME sniffing — браузер не повинен "вгадувати" тип файлу
    add_header X-Content-Type-Options "nosniff";
    
    # Основний блок обробки запитів
    location / {
       

        try_files $uri $uri/ /index.php?$query_string;
        # Логіка:
        # 1. Якщо файл існує → віддає файл
        # 2. Якщо каталог існує → відкриває каталог
        # 3. Інакше передає запит Laravel (в index.php) з усіма GET-параметрами
        #
        # Це дозволяє працювати роутам Laravel типу /api/users, /dashboard тощо
    }
    # Обробка PHP-файлів
    location ~ \.php$ {
        
        # Все, що закінчується на .php → відправляється PHP-FPM

        fastcgi_pass backend:9000;
        # ВАЖЛИВО!
        # "backend" — це ім'я контейнера з PHP-FPM у docker-compose
        # 9000 — порт PHP-FPM

        # Файл за замовчуванням, якщо вказаний лише каталог
        fastcgi_index index.php;
        # Стандартний набір FastCGI параметрів (SCRIPT_NAME, QUERY_STRING і т.д.)
        include fastcgi_params;
        
        # Повний шлях до виконуваного PHP-файлу
        # Напр. /var/www/html/public/index.php
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        
    }
    # Закриваємо все, що починається з . (наприклад .env)
    # Крім /.well-known (для SSL challenge)
    location ~ /\.(?!well-known).* {
        
        
        # Заборонити доступ до конфіденційних прихованих файлів
        deny all;
       
    }
}
